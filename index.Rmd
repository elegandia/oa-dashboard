---
title: "Open Access Dashboard "
output: 
  flexdashboard::flex_dashboard:
    css: styles.css
    orientation: rows
    vertical_layout: scroll
    source_code: embed
    navbar:
      - { title: "Datentabellen", href: "https://medbib-charite.github.io/oa-dashboard/tables", align: right }
    
# author: Jan Taubitz
# email: jan.taubitz@charite.de
# source_code: https://github.com/medbib-charite/oa-dashboard
---

```{r setup, include=FALSE}
library(flexdashboard)

source("data_1.R", encoding = 'UTF-8')
source("data_3_rcrossref.R", encoding = 'UTF-8')
```

Dashboard {data-icon="fa-globe"}
===================================== 

Row 
-----------------------------------------------------------------------

```{r}
##+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
## Analysis for gauges
##+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

load("data/data_unpaywall.Rda")

is_oa <- data %>%
  group_by(jahr, oa_status, is_oa) %>%
  summarise(count = n()) %>%
  group_by(jahr) %>%
  mutate(perc = round(count / sum(count) * 100, 1)) %>% 
  # eliminate rounding differences created by different groupings
  group_by(jahr, is_oa) %>%
  summarise(count = sum(count), perc = sum(perc))

is_doaj <- sort(table(data_unpaywall$journal_is_in_doaj), decreasing = TRUE)
is_doaj <- round(4152/sum(is_doaj)*100, 1)

is_corresponding <- sort(table(data$corresponding_author_cha), decreasing = TRUE)
is_corresponding <- round(6292/sum(is_corresponding)*100, 1)
```


### Open Access-Artikel mit Charité-Beteiligung 2018

```{r}
rate <- is_oa %>% filter(jahr == 2018 & is_oa == TRUE) %>% pull(perc)
gauge(rate, min = 0, max = 100, symbol = ' %', gaugeSectors(colors = "#e97202"))
```

### Open Access-Artikel mit Charité-Beteiligung 2019

```{r}
rate <- is_oa %>% filter(jahr == 2019 & is_oa == TRUE) %>% pull(perc)
gauge(rate, min = 0, max = 100, symbol = ' %', gaugeSectors(colors = "#e97202"))
```

### Open Access-Artikel mit Charité-Beteiligung 2020

```{r}
rate <- is_oa %>% filter(jahr == 2020 & is_oa == TRUE) %>% pull(perc)
gauge(rate, min = 0, max = 100, symbol = ' %', gaugeSectors(colors = "#e97202"))
```


Row 
-----------------------------------------------------------------------

### Artikel mit Charité-Corresponding Author 2018-2020

```{r}
rate <- is_corresponding
gauge(rate, min = 0, max = 100, symbol = ' %', gaugeSectors(
  success = c(40, 100), warning = c(30, 39), danger = c(0, 29)
))
```

### Artikel erscheint in einer reinen Open Access-Zeitschrift (vgl. [DOAJ](https://doaj.org/)) 2018-2020

```{r}
rate <- is_doaj
gauge(rate, min = 0, max = 100, symbol = ' %', label= "Quelle: Unpaywall", gaugeSectors(colors = "#e97202"))
```

Row {data-height=auto}
-----------------------------------------------------------------------

### Analyse 1

<font size="5"> Open Access-Status von Artikeln mit Charité-Beteiligung insgesamt und von Artikeln mit Charité-Corresponding Author 2018-2020</font>

Row {data-height=auto}
-----------------------------------------------------------------------

### Artikel mit Charité-Beteiligung (in %)

```{r}
status_percent
```

### Artikel mit Charité-Corresponding Author (in %)

```{r}
status_corresponding_percent
```

Row {data-height=auto}
-----------------------------------------------------------------------

### Artikel mit Charité-Beteiligung (absolute Zahlen)

```{r}
status_absolute_spline
```

### Artikel mit Charité-Corresponding Author (absolute Zahlen)

```{r}
status_corresponding_absolute_spline
```

Row {data-height=auto}
-----------------------------------------------------------------------

### Analyse 2

<font size="5"> Open Access-Status von Artikeln mit Charité-Beteiligung nach Verlagen und Zeitschriften im Jahr 2020</font>

Row {data-height=auto}
-----------------------------------------------------------------------

### Artikel nach Verlagen in absoluten Zahlen

```{r}
publisher_absolute
```

### Artikel nach Zeitschriften in absoluten Zahlen

```{r}
journal_absolute
```

Row {.tabset}
-----------------------------------------------------------------------

### Zentrale Förderung von Artikeln mit Charité-Corresponding Author 2018-2020 nach Verlagen (Top 10)

```{r}
publisher_costs
```

### ... und nach Jahren

```{r}
publisher_costs_year
```

Row {data-height=auto}
-----------------------------------------------------------------------

### Analyse 3

<font size="5"> Lizenzen der mit Charité-Beteiligung publizierten Artikel 2018-2020</font>

Row 
-----------------------------------------------------------------------

### Lizenzen für alle Artikel (Quelle: Unpaywall)

```{r}
load("charts/chart_lizenzen.Rda")
chart_lizenzen
```

### Lizenzen für Artikel mit OA-Status gold, hybrid oder green (Quelle: Unpaywall)

```{r}
load("charts/chart_lizenzen_oa.Rda")
chart_lizenzen_oa
```
